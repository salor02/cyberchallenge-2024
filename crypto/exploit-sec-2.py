import socket
import string
import time
from pwn import *

HOST = "padding.challs.cyberchallenge.it"  # Standard loopback interface address (localhost)
PORT = 9030  # Port to listen on (non-privileged ports are > 1023)

alfa = string.ascii_lowercase + '0123456789_{}' + string.ascii_uppercase

s = remote(HOST, PORT)
data = s.recvuntil(b':').decode()
print(data)

msg = 'ciaociaociaociaociaociaociaocia'
to_send = msg + '\n'
s.send(bytes(to_send.encode()))
data = s.recvuntil(b'encrypt:').decode()
prev_oracle = data[71:103]
print(data)
print(msg + ' ' + prev_oracle)

found = ""

for i in range(32):
    for char in alfa:
        to_send = ""
        to_send = msg + found + char + '\n'
        print(to_send)
        s.send(bytes(to_send.encode()))

        data = s.recvuntil(b'encrypt:').decode()
        oracle = data[71:103]
        print(data+'\n'+oracle)

        if oracle == prev_oracle:
            found = found + char
            num = 2 + len(found)
            msg = to_send[0:-num]
            print('[FOUND] ' + found)

            to_send = msg + '\n'
            print(to_send)
            s.send(bytes(to_send.encode()))

            data = s.recvuntil(b'encrypt:').decode()
            prev_oracle = data[71:103]
            print("[NEW ORACLE] " + prev_oracle)
            break


    